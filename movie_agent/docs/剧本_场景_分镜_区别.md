# 剧本、场景、分镜 是啥？谁用哪个 LLM、根据什么素材生成？

容易搞混，直接说结论：

- **Plot/Visual Description** 不是「写剧本」那一步出来的，而是 **「分镜」这一步** 里、由**分镜 LLM** 为**每一个镜头**写的那段「这一镜画面在画什么」的英文描述。

下面按流程说：**每一步用的是哪个 LLM、根据什么素材生成的**。

---

## 三步分别：谁生成、根据啥

| 步骤 | 方法名 | 用的 LLM（名字） | LLM 的 system prompt | 根据的素材（输入） | 产出文件 | 产出内容 |
|------|--------|------------------|----------------------|--------------------|----------|----------|
| 1. 剧本拆分 | ScriptBreak | **args.LLM**（默认 gpt4-o） | `screenwriterCoT-sys` | **你提供的剧本文件**（`--script_path`，如 `script_synopsis.json`）里的 **MovieScript**（整部剧本梗概）+ **Character**（角色列表） | Step_1_script_results.json | 子剧本：每个子剧本一段 **Plot**、**Relationships** 等 |
| 2. 场景规划 | ScenePlanning | **args.LLM**（同上） | `ScenePlanningCoT-sys` | **Step_1** 里每个子剧本的 **Plot** + **Relationships** | Step_2_scene_results.json | 场景：每个场景的 **Plot**、Scene Description、Involving Characters、Emotional Tone、Key Props、Cinematography Notes |
| 3. 分镜 | ShotPlotCreate | **args.LLM**（同上） | `ShotPlotCreateCoT-sys` | **Step_2** 里**当前场景**的：Involving Characters、Plot、Scene Description、Emotional Tone、Key Props、Cinematography Notes | Step_3_shot_results.json | 镜头：每个镜头的 **Plot/Visual Description**、Coarse Plot、Involving Characters、Subtitles 等 |

也就是说：**三步都用同一个 LLM（你传的 `--LLM`，默认 gpt4-o）**，只是用的 **system prompt 不同**（分别是 screenwriterCoT、ScenePlanningCoT、ShotPlotCreateCoT），并且**每一步的输入 = 上一步的产出 + 对应 JSON 里的字段**。

---

## 素材来源再捋一遍

- **Step_1 的输入**：来自 **你给的剧本文件**（例如「我的故事」用 `story_to_script.py` 生成的 `script_synopsis.json`）。代码里用 `extract_characters_from_json(self.script_path)` 读出 **MovieScript**、**Character**，只把这两类东西喂给「剧本拆分」的 LLM。
- **Step_2 的输入**：来自 **Step_1 的 JSON**：每个子剧本的 **Plot**、以及整份里的 **Relationships**。
- **Step_3 的输入**：来自 **Step_2 的 JSON**：当前要分镜的**那个场景**的 Involving Characters、Plot、Scene Description、Emotional Tone、Key Props、Cinematography Notes。

所以：**剧本拆分 = 根据「整部剧本梗概 + 角色列表」生成子剧本；场景规划 = 根据「子剧本 Plot + 角色关系」生成场景；分镜 = 根据「单个场景的所有字段」生成每个镜头的 Plot/Visual Description 等。**

---

## 数据流一句话

- **剧本**（Step_1）→ 子剧本的 **Plot**（一段话讲这段故事）。
- **场景**（Step_2）→ 每个场景的 **Plot**、Scene Description 等（这段戏在哪儿、谁在、情绪、道具等）。
- **分镜**（Step_3）→ 每个镜头的 **Plot/Visual Description**（这一镜「画面里在画什么」的英文描述）、Coarse Plot 等。

关键帧生成时，用到的就是 Step_3 里、**每个镜头**的 **Plot/Visual Description**（或 ROICtrl 时的 Coarse Plot），不是剧本那层的 Plot。

---

## 总结

- **三步都是同一个 LLM**（`--LLM`，默认 gpt4-o），只是 **system prompt 不同**（见 `system_prompts.py` 里的 screenwriterCoT-sys、ScenePlanningCoT-sys、ShotPlotCreateCoT-sys）。
- **剧本拆分**：根据 **剧本文件里的 MovieScript + Character** 生成子剧本。
- **场景规划**：根据 **Step_1 的 Plot + Relationships** 生成场景。
- **分镜**：根据 **Step_2 里该场景的各类字段** 生成每个镜头的 **Plot/Visual Description** 等。
