# 关键帧：图 + 文本 → 图 的模型选择

Ideogram Character 对「双人、严格画风」经常只出一个角色或画风跑偏，可以换用下面几种「参考图 + 文本」生图方式做关键帧。

---

## 1. FLUX Kontext（推荐先试）

- **是什么**：Black Forest Labs 的 FLUX.1 Kontext，**参考图 + 文本** 生成/编辑图，更吃参考图内容。
- **用法**：  
  `--gen_model Replicate_flux_kontext`  
  其他参数和 Replicate 一样（`--script_path`、`--character_photo_path`、`--resume_from_shots` 等）。
- **参考图**：和现在一样，双人镜会把你两个角色（布布、一二）拼成一张左右并排图送进去，prompt 里会强调「参考图里左右两个角色、严格按参考」。
- **环境**：要 `REPLICATE_API_TOKEN`，和 Ideogram 相同。
- **说明**：Kontext 是「以参考图为底」的编辑/生成，理论上更容易保留参考图里的两个角色和画风，适合「两个参考角色」这种双人、固定造型。

---

## 2. 当前已支持的其它关键帧模型

| 选项 | 说明 |
|------|------|
| `--gen_model Replicate` | 默认，Ideogram Character（参考图+文本）。单角色尚可，双人/画风容易不稳。 |
| `--gen_model Replicate_flux_kontext` | FLUX Kontext（参考图+文本），推荐作为替代。 |
| `--gen_model OpenAI` | DALL·E 3，**无参考图**，只用文本；会从 `character_style.txt` 注入角色/画风描述，一致性靠 prompt。 |
| `--gen_model ROICtrl` | 本地 ROI 控制，需本地权重。 |
| `--gen_model StoryDiffusion` | 本地 StoryDiffusion，需本地环境。 |

---

## 3. 自己换 Replicate 上的其它模型

若想用 Replicate 上别的「图+文」模型（例如别的 FLUX、InstantID 等）：

1. 在 `configs/` 下复制 `Replicate.json` 为 `Replicate_xxx.json`。
2. 把里面的 `replicate_model` 改成目标模型名，例如 `"black-forest-labs/flux-kontext-pro"` 或其它。
3. 运行 `--gen_model Replicate_xxx`。

若该模型的 API 不是 `character_reference_image`/`input_image` + `prompt`，需要在 `models/Replicate_Consistent/replicate_consistent.py` 里为该模型加一段输入/输出解析（可参考现有 `_use_ideogram` / `_use_flux_kontext` 分支）。

---

## 4. 小结

- **只想换一个更听话的「图+文」模型**：用  
  `--gen_model Replicate_flux_kontext`  
  试关键帧，其它流程不变。
- **仍只出一个角色/画风不对**：再看参考图是否足够清晰、两人是否都在一张里，以及 prompt 里是否写清「左右两个角色、严格按参考图」。
